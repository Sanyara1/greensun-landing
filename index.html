<!DOCTYPE html>
<html lang="ru">
<link href="https://fonts.googleapis.com/css2?family=Manrope:wght@600;800&display=swap" rel="stylesheet">
<style>
/* === GREENSUN · CASES (build) === */
.gs-cases{ padding: 48px 20px; background: transparent; }
.gs-cases .gs-container{ max-width: 1200px; margin: 0 auto; }
.gs-cases-title{ margin:0 0 8px; font-weight: 800; font-size: clamp(24px, 3vw, 36px); letter-spacing: -0.02em; color: var(--deep-teal, #0E3B2E); }
.gs-cases-sub{ margin:0 0 16px; color: var(--gs-muted, #6B7280); }
.gs-cases-grid{ display:grid; gap:16px; grid-template-columns: repeat(2, minmax(0,1fr)); }
@media (max-width: 900px){ .gs-cases-grid{ grid-template-columns: 1fr; } }
.gs-case-card{ background:#fff; border:1px solid var(--gs-line, #E5EFE9); border-radius:16px; padding:18px; box-shadow: 0 10px 24px rgba(0,0,0,.06); }
.gs-case-head{ display:flex; align-items:center; justify-content:space-between; gap:10px; margin-bottom:6px; }
.gs-case-title{ font-weight:800; font-size:18px; letter-spacing:-.01em; color: var(--slate, #1F2937); }
.gs-case-meta{ color: var(--gs-muted, #6B7280); font-size:12px; white-space:nowrap; }
.gs-case-stats{ display:flex; flex-wrap:wrap; gap:10px; margin:10px 0 8px; }
.gs-pill{ background: rgba(24,169,87,.10); color: var(--deep-teal, #0E3B2E); border: 1px solid rgba(24,169,87,.22); padding: 6px 10px; border-radius: 999px; font-weight: 700; font-size: 12px; }
.gs-case-addr{ color:#374151; font-size:14px; }
/* === GSun brand tweaks === */
h1, h2, h3, .display, .card-title { font-family: Manrope, Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
.price-tag { display:flex; align-items:baseline; gap:6px; font-weight:800; font-size:28px; margin:6px 0 12px; }
.price-tag small { font-weight:600; font-size:12px; color:#6b7280; }
/* 3-колоночная сетка на десктопе */
#package .grid { display:grid; grid-template-columns: repeat(3, minmax(0,1fr)) !important; gap:16px; }
@media (max-width: 1024px){ #package .grid { grid-template-columns: repeat(2, minmax(0,1fr)) !important; } }
@media (max-width: 640px){ #package .grid { grid-template-columns: 1fr !important; } }
/* === Map overlay click-through fix === */
#map .map{ position:relative; }
#map .map::after{ pointer-events:none; z-index:0; }
#map .map > *{ position:relative; z-index:1; }
#map .chip, #map .btn{ position:relative; z-index:2; }
/* Segmented control for Franchise */
.seg { display:inline-flex; gap:8px; background:#f3f4f6; padding:6px; border-radius:12px; border:1px solid #e5e7eb }
.seg-btn { border:0; background:#fff; padding:10px 14px; border-radius:10px; font-weight:700; cursor:pointer }
.seg-btn.is-active { background: var(--emerald, #18A957); color:#fff; box-shadow: 0 0 0 2px rgba(24,169,87,.15) inset }
.seg-btn:focus-visible { outline:2px solid var(--emerald, #18A957); outline-offset:2px }
/* Highlight for chosen card */
.franch-card.is-highlighted { border:2px solid var(--emerald, #18A957); box-shadow: 0 10px 28px rgba(24,169,87,.15) }
/* Franchise segmented control + highlight */
.seg { display:inline-flex; gap:8px; background:#f3f4f6; padding:6px; border-radius:12px; border:1px solid #e5e7eb; margin-bottom:12px }
.seg-btn { border:0; background:#fff; padding:10px 14px; border-radius:10px; font-weight:700; cursor:pointer }
.seg-btn.is-active { background: var(--emerald, #18A957); color:#fff; box-shadow: 0 0 0 2px rgba(24,169,87,.15) inset }
.seg-btn:focus-visible { outline:2px solid var(--emerald, #18A957); outline-offset:2px }
/* Highlight for chosen card */
#package .card.is-highlighted { border:2px solid var(--emerald, #18A957) !important; box-shadow: 0 10px 28px rgba(24,169,87,.15) !important; }
/* Modal */
.modal{ position:fixed; inset:0; background:rgba(17,24,39,.5); display:none; align-items:center; justify-content:center; padding:16px; z-index:50 }
.modal.is-open{ display:flex }
.modal-card{ width:min(680px, 96vw); background:#fff; border-radius:16px; border:1px solid #e5e7eb; box-shadow:0 20px 60px rgba(0,0,0,.2); overflow:hidden }
.modal-head{ display:flex; align-items:center; justify-content:space-between; padding:14px 16px; border-bottom:1px solid #e5e7eb }
.modal-title{ font-weight:800; font-size:18px }
.modal-close{ border:0; background:#fff; padding:8px; border-radius:8px; cursor:pointer }
.modal-body{ padding:16px }
.grid-2{ display:grid; grid-template-columns:1fr 1fr; gap:12px }
@media (max-width:720px){ .grid-2{ grid-template-columns:1fr } }
.input, .textarea{ width:100%; border:1px solid #d1d5db; border-radius:10px; padding:10px 12px; font:inherit }
.textarea{ min-height:90px; resize:vertical }
.modal-foot{ padding:16px; border-top:1px solid #e5e7eb; display:flex; align-items:center; justify-content:flex-end; gap:10px }
.badge{ display:inline-flex; align-items:center; gap:8px; padding:6px 10px; border-radius:999px; background:#F9FAFB; border:1px solid #e5e7eb; font-size:12px }

/* === Состояние "Занято" для чипов на карте === */
.chip.occupied {
  background: #fef2f2;
  border-color: #fecaca;
}
.chip.occupied > div:first-child {
  background: #ef4444;
}

/* === Анимация и стиль для карточек франшиз === */
#package .card {
  opacity: 0.6;
  filter: grayscale(80%);
  pointer-events: none;
  transition: opacity 0.3s ease, filter 0.3s ease, transform 0.3s ease, border 0.3s ease, box-shadow 0.3s ease;
}
#package .card.is-highlighted {
  opacity: 1;
  filter: none;
  pointer-events: auto;
  transform: translateY(0);
}
</style>
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Greensun — Франшиза солнечных станций</title>
  <meta name="description" content="Франшиза солнечных станций под ключ: проектирование, монтаж, мониторинг и цифровая верификация энергии через GNSun."/>
  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <!-- Icons (lucide) -->
  <script defer src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
  <style>
    :root{
      --gold:#FFC83A;
      --teal:#0E3B2E;
      --emerald:#18A957;
      --slate:#1F2937;
      --light:#F3F4F6;
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif;color:#111827;background:#fff}
    a{color:inherit;text-decoration:none}
    .container{max-width:1120px;margin:0 auto;padding:0 16px}
    .btn{display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border-radius:12px;border:1px solid #e5e7eb;background:#fff;cursor:pointer;font-weight:600}
    .btn.primary{background:var(--teal);color:#fff;border-color:var(--teal)}
    .btn.emerald{background:var(--emerald);color:#fff;border-color:var(--emerald)}
    .btn.outline{background:#fff;color:#111827;border-color:#d1d5db}
    .badge{display:inline-block;padding:3px 8px;border-radius:999px;font-size:12px;background:var(--teal);color:#fff}
    header.sticky{position:sticky;top:0;z-index:40;background:rgba(255,255,255,.8);backdrop-filter:blur(8px);border-bottom:1px solid #e5e7eb}
    header .nav a{font-size:14px;color:#374151}
    header .nav a:hover{color:#111827}
    .grid{display:grid;gap:24px}
    .grid.two{grid-template-columns:1fr}
    @media (min-width: 1024px){.grid.two{grid-template-columns:1fr 1fr}}
    .section{padding:64px 0}
    .section.light{background:var(--light)}
    h1{font-size:40px;line-height:1.1;margin:0}
    @media (min-width:640px){h1{font-size:52px}}
    h2{font-size:30px;margin:0}
    p.lead{font-size:18px;color:#4b5563;max-width:60ch}
    .card{border:1px solid #e5e7eb;border-radius:16px;background:#fff;box-shadow:0 2px 10px rgba(0,0,0,.04)}
    .card .card-header{padding:16px 16px 0 16px}
    .card .card-title{font-weight:700}
    .card .card-content{padding:16px}
    .stat{display:flex;align-items:center;gap:12px;padding:12px;border-radius:12px;background:#ffffffb3;border:1px solid #eee}
    .stat .icon{padding:8px;border-radius:10px;background:#F3F4F6}
    .muted{color:#6b7280}
    .calc-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .input{width:100%;padding:10px 12px;border:1px solid #e5e7eb;border-radius:10px;font-size:14px}
    label{display:block;font-size:12px;color:#6b7280;margin-bottom:6px}
    .pill{padding:12px;border-radius:12px;background:#F9FAFB;border:1px solid #e5e7eb}
    ul.disc{padding-left:18px}
    ul.disc li{margin:6px 0;list-style:disc}
    .accordion-item{border-bottom:1px solid #e5e7eb}
    .accordion-trigger{width:100%;text-align:left;background:none;border:none;padding:16px 0;font-size:16px;font-weight:600;cursor:pointer}
    .accordion-content{display:none;padding:0 0 16px 0;color:#4b5563}
    .accordion-item.open .accordion-content{display:block}
    footer{border-top:1px solid #e5e7eb}
    .tiny{font-size:12px;color:#9ca3af}
    .hex{display:inline-block;vertical-align:middle}
    .map{position:relative;height:440px;border-radius:16px;border:1px solid #e5e7eb;overflow:hidden;background:radial-gradient(1200px 400px at 20% 30%, #E5F6EE 0%, #ffffff 60%)}
    .map::after{content:"";position:absolute;inset:0;opacity:.08;background-image:repeating-linear-gradient(90deg, #0E3B2E 0, #0E3B2E 1px, transparent 1px, transparent 40px), repeating-linear-gradient(#0E3B2E 0, #0E3B2E 1px, transparent 1px, transparent 40px)}
    .chip{display:flex;align-items:center;gap:8px;background:#fff;border:1px solid #e5e7eb;border-radius:999px;padding:6px 10px;box-shadow:0 2px 10px rgba(0,0,0,.04)}
  </style>
</head>
<body>
  <!-- Header -->
  <header class="sticky">
    <div class="container" style="height:64px;display:flex;align-items:center;justify-content:space-between;">
      <div style="display:flex;align-items:center;gap:10px;">
        <span class="hex" id="hex-28"></span>
        <span style="font-weight:600;letter-spacing:.02em;">Greensun</span>
        <span class="badge">GNSun</span>
      </div>
      <nav class="nav" style="display:none;gap:20px;align-items:center" id="nav-desktop">
        <a href="#how">Как это работает</a>
        <a href="#unit">Экономика</a>
        <a href="#map">Карта</a>
        <a href="#package">Пакет франшизы</a>
        <a href="#cases">Кейсы</a>
        <a href="#faq">FAQ</a>
      </nav>
      <div style="display:flex;gap:8px;align-items:center">
        <a class="btn outline" style="display:none" id="brandkit-btn" href="#" download>Скачать бренд‑кит</a>
        <a class="btn primary" href="#cta">Стать франчайзи <i data-lucide="arrow-right" style="width:16px;height:16px"></i></a>
      </div>
    </div>
  </header>
  <!-- Hero -->
  <section class="section light">
    <div class="container">
      <div class="grid two" style="align-items:center">
        <div>
          <h1>Франшиза солнечных станций <span style="color:var(--emerald)">«под ключ»</span></h1>
          <p class="lead" style="margin-top:16px">
            Полный цикл: проектирование, монтаж, мониторинг и цифровая верификация происхождения энергии через токен <b>GNSun</b> (Polygon).
            Чистая генерация + понятная экономика для B2B-объектов.
          </p>
          <div style="margin-top:20px;display:flex;flex-wrap:wrap;gap:10px">
            <a class="btn primary" href="#cta">Получить презентацию <i data-lucide="arrow-right" style="width:16px;height:16px"></i></a>
            <a class="btn outline" href="#cases">Смотреть кейсы</a>
          </div>
          <div style="margin-top:24px;display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:10px">
            <div class="stat">
              <div class="icon"><i data-lucide="factory" style="width:20px;height:20px;color:var(--teal)"></i></div>
              <div>
                <div class="tiny" style="font-size:12px">Установленная мощность</div>
                <div style="font-weight:600">200 кВт</div>
              </div>
            </div>
            <div class="stat">
              <div class="icon"><i data-lucide="bar-chart-3" style="width:20px;height:20px;color:var(--teal)"></i></div>
              <div>
                <div class="tiny" style="font-size:12px">Средняя генерация (100 кВт)</div>
                <div style="font-weight:600">16.8 МВт·ч/мес</div>
              </div>
            </div>
            <div class="stat">
              <div class="icon"><i data-lucide="leaf" style="width:20px;height:20px;color:var(--teal)"></i></div>
              <div>
                <div class="tiny" style="font-size:12px">CO₂ компенсация</div>
                <div style="font-weight:600">12 т/мес</div>
              </div>
            </div>
          </div>
          <div class="tiny" style="margin-top:6px">*по действующим станциям в Сочи</div>
        </div>
        <div id="unit">
          <div class="card">
            <div class="card-header">
              <div class="card-title" style="display:flex;align-items:center;gap:8px">
                <i data-lucide="calculator" style="width:20px;height:20px"></i> Unit‑экономика
              </div>
            </div>
            <div class="card-content">
              <div class="calc-grid">
                <div>
                  <label>Мощность станции (кВт)</label>
                  <input id="capacityKW" class="input" type="number" min="10" max="1000" value="50"/>
                </div>
                <div>
                  <label>Тариф (₽/кВт·ч)</label>
                  <input id="tariff" class="input" type="number" step="0.01" min="0" value="14.65"/>
                </div>
                <div>
                  <label>Коэф. инсоляции (0.8–1.2)</label>
                  <input id="insolation" class="input" type="number" step="0.05" min="0.5" max="1.5" value="1"/>
                </div>
                <div>
                  <label>Стоимость проекта (₽)</label>
                  <input id="projectCost" class="input" type="number" step="1000" min="0" value="0"/>
                </div>
              </div>
              <div class="calc-grid" style="margin-top:12px">
                <div class="pill">
                  Месячная генерация<br/>
                  <span id="monthlyKWh" style="font-size:20px;font-weight:700">—</span> <span>кВт·ч</span>
                </div>
                <div class="pill">
                  Выручка/мес<br/>
                  <span id="monthlyRevenue" style="font-size:20px;font-weight:700">—</span> <span>₽</span>
                </div>
              </div>
              <div class="tiny" id="calcNote" style="margin-top:8px">
                Расчёт ориентировочный. Фактические цифры зависят от инсоляции, оборудования и профиля потребления.
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
  <!-- How it works -->
  <section id="how" class="section">
    <div class="container">
      <h2>Как это работает</h2>
      <p class="muted" style="margin-top:8px">От аудита до токенизированной верификации — под одной крышей.</p>
      <div class="grid" style="margin-top:20px;grid-template-columns:repeat(1,minmax(0,1fr))">
        <div class="grid" style="grid-template-columns:repeat(1,minmax(0,1fr));gap:16px">
          <div class="card">
            <div class="card-header"><div class="card-title" style="display:flex;align-items:center;gap:8px;color:#065f46">
              <i data-lucide="building-2" style="width:20px;height:20px"></i> Аудит объекта</div></div>
            <div class="card-content muted">Оценка крыши/площадки, юг/углы, сеть, смета</div>
          </div>
          <div class="card">
            <div class="card-header"><div class="card-title" style="display:flex;align-items:center;gap:8px;color:#065f46">
              <i data-lucide="zap" style="width:20px;height:20px"></i> Монтаж 50–500 кВт</div></div>
            <div class="card-content muted">Проект, поставка, инсталляция, пусконаладка</div>
          </div>
          <div class="card">
            <div class="card-header"><div class="card-title" style="display:flex;align-items:center;gap:8px;color:#065f46">
              <i data-lucide="shield" style="width:20px;height:20px"></i> Мониторинг</div></div>
            <div class="card-content muted">Личный кабинет, регламентное ТО, отчёты</div>
          </div>
          <div class="card">
            <div class="card-header"><div class="card-title" style="display:flex;align-items:center;gap:8px;color:#065f46">
              <i data-lucide="qrcode" style="width:20px;height:20px"></i> Верификация GSun</div></div>
            <div class="card-content muted">QR-страница, происхождение энергии, CO₂</div>
          </div>
        </div>
      </div>
    </div>
  </section>
<!-- Map -->
<section id="map" class="section light">
  <div class="container">
    <h2>Карта присутствия</h2>
    <p class="muted" style="margin-top:8px">Запущено в Сочи. Открыты к пилотам в новых регионах.</p>

    <!-- Обертка в 2 колонки -->
    <div class="grid" style="margin-top:24px; grid-template-columns: 2fr 1fr; gap: 24px; align-items: start;">

      <!-- Колонка 1: Карта -->
      <div class="map-container" style="position: relative; border-radius:16px; overflow:hidden; box-shadow: 0 8px 24px rgba(0,0,0,0.08);">
        <div class="map" style="
  background-image: url('https://images.unsplash.com/photo-1579547945413-497e1b99dac0?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80');
  background-size: cover;
  background-position: center;
  position: relative;
  height: 440px;
  border-radius: 16px;
  border: 1px solid #e5e7eb;
  overflow: hidden;
">
  <!-- Занятый чип -->
  <div class="chip occupied" data-lat="43.908" data-lon="39.330" style="position:absolute;left:54%;top:49%;transform:translate(-50%,-50%); z-index: 2;">
    <div style="width:10px;height:10px;border-radius:999px;background:var(--emerald)"></div>
    <div class="tiny" style="color:#374151;font-size:12px; white-space: nowrap;">Сочи — п. Лазаревское</div>
  </div>
  <!-- Подсказка внизу карты -->
  <div class="tiny" style="position:absolute;left:16px;bottom:14px;background:#ffffffcc;border:1px solid #e5e7eb;padding:6px 10px;border-radius:8px; backdrop-filter: blur(4px);">
    Готовы к подключению франчайзи в вашем регионе → оставьте заявку
  </div>
</div>
      </div>

      <!-- Колонка 2: Блок "Радиус: совокупная генерация" -->
      <div class="card" id="pro-radius-card" style="flex-shrink:0; position: sticky; top: 24px; box-shadow: 0 8px 24px rgba(0,0,0,0.06);">
        <div class="card-header">
          <div class="card-title" style="display:flex;align-items:center;gap:8px">
            <i data-lucide="target" style="width:18px;height:18px"></i>
            Радиус: совокупная генерация
          </div>
        </div>
        <div class="card-content">
          <div class="grid" style="grid-template-columns:1fr 1fr; gap:12px">
            <div>
              <label>Центр расчёта</label>
              <select id="radiusCenter" class="input" style="font-size: 14px;">
                <option value="pavlova2">Сочи, Лазаревское — Павлова, 2</option>
                <option value="kalarasha131">Сочи, Лазаревское — Калараша, 131</option>
                <option value="kalarasha36">Сочи, Лазаревское — Калараша, 36</option>
                <option value="pilot_center">Лазаревское — центр (пилот)</option>
                <option value="pilot_shosse2">Сочинское ш., 2 (пилот)</option>
              </select>
            </div>
            <div>
              <label>Радиус (км)</label>
              <input id="radiusKm" class="input" type="number" min="1" max="20" step="0.5" value="5" style="font-size: 14px;"/>
            </div>
          </div>
          <div class="grid" style="margin-top:12px; grid-template-columns:1fr 1fr 1fr; gap:8px;">
            <label class="pill" style="display:flex;align-items:center;gap:6px; font-size: 13px; padding: 8px;">
              <input id="useMapCenter" type="checkbox"> Брать центр с карты
            </label>
            <label class="pill" style="display:flex;align-items:center;gap:6px; font-size: 13px; padding: 8px;">
              <input id="excludeSelf" type="checkbox" checked> Исключить свой объект
            </label>
            <button id="syncMapCenter" class="btn outline" type="button" style="font-size: 13px; padding: 8px 10px;">Синхронизировать</button>
          </div>
          <div class="tiny" style="margin-top:8px; font-size: 12px;">
            Центр: <b><span id="centerLat">—</span>, <span id="centerLon">—</span></b>
          </div>
          <div class="grid" style="margin-top:12px; grid-template-columns:1fr 1fr; gap:8px;">
            <div class="pill" style="padding: 10px; font-size: 13px;">
              Объектов: <b><span id="rCount">—</span></b>
            </div>
            <div class="pill" style="padding: 10px; font-size: 13px;">
              Сумма: <b><span id="rMWh">—</span> МВт·ч/мес</b>
            </div>
            <div class="pill" style="padding: 10px; font-size: 13px;">
              Доля Pro 10%: <b><span id="rProMWh">—</span> МВт·ч/мес</b>
            </div>
            <div class="pill" style="padding: 10px; font-size: 13px;">
              Начисления*: <b><span id="rProRub">—</span> ₽/мес</b>
            </div>
          </div>
          <div class="tiny" style="margin-top:8px; font-size: 12px;">*По текущему тарифу в калькуляторе выше.</div>
        </div>
      </div>

    </div> <!-- Конец grid-обертки -->
  </div>
</section>
  <!-- Franchise package -->
  <section id="package" class="section">
  <div class="container">
    <h2>Пакеты франшизы</h2>
    <p class="muted" style="margin-top:8px">Примерная конфигурация. Условия уточняются под ваш регион и профиль объектов.</p>
<div class="seg" id="franchTabs" role="tablist" aria-label="Франшизы">
  <button class="seg-btn" role="tab" aria-selected="true" aria-controls="pack-pro" data-target="pro">Pro</button>
  <button class="seg-btn" role="tab" aria-selected="false" aria-controls="pack-start" data-target="start">Start</button>
  <button class="seg-btn" role="tab" aria-selected="false" aria-controls="pack-enterprise" data-target="enterprise">Enterprise</button>
</div>
<div class="grid" style="margin-top:16px">
      <!-- Start -->
      <div class="card" id="pack-start" data-pack="start">
        <div class="card-header">
          <div class="card-title"><i data-lucide="rocket" style="width:16px;height:16px"></i> Start (50–100 кВт)</div>
        </div>
        <div class="card-content muted">
          <div class="price-tag"><span>₽ 4 950 000</span> <small>единоразово</small></div>
          <ul class="disc">
            <li>Айдентика и сайт-лендинг</li>
            <li>Шаблоны коммерческих и смет</li>
            <li>Базовая поддержка монтажа</li>
            <li>Мониторинг 1 объекта</li>
            <li>Юр. пакет (RU)</li>
			<li>Комплект оборудования на 50 кВТ</li>
          </ul>
        </div>
        <div class="card-footer"><a class="btn primary" href="#contact">Оставить заявку</a></div>
      </div>
      <!-- Pro -->
      <div class="card" id="pack-pro" data-pack="pro">
        <div class="card-header">
          <div class="card-title"><i data-lucide="zap" style="width:16px;height:16px"></i> Pro (100–200 кВт)</div>
        </div>
        <div class="card-content muted">
          <div class="price-tag"><span>₽ 8 990 000</span> <small>единоразово</small></div>
          <ul class="disc">
            <li>Система мониторинга + веб-доступ</li>
            <li>MVP токенизации (Polygon, NFT-сертификат)</li>
            <li>Методика учёта CO₂ (черновая Verra/GS)</li>
            <li>Техподдержка, регламент ТО</li>
            <li>ТО: ₽ 22 000 / квартал</li>
			<li>Комплект оборудования на 100 кВТ</li>
          </ul>

          

        </div>
        <div class="card-footer"><a class="btn emerald" href="#contact">Стать партнёром</a></div>
      </div>
      <!-- Enterprise -->
      <div class="card" id="pack-enterprise" data-pack="enterprise">
        <div class="card-header">
          <div class="card-title"><i data-lucide="factory" style="width:16px;height:16px"></i> Enterprise (200–500+ кВт)</div>
        </div>
        <div class="card-content muted">
          <div class="price-tag"><span>₽ 15 900 000</span> <small>единоразово</small></div>
          <ul class="disc">
            <li>Интеграция с ERP/биллингом</li>
            <li>Модель CO₂-компенсации (Gold Standard/Verra-ready)</li>
            <li>Личный кабинет B2B, SLA</li>
            <li>Архитектура под мульти-локации</li>
            <li>PR-поддержка на запуске</li>
			<li>Комплект оборудования на 200 кВТ</li>
          </ul>
        </div>
        <div class="card-footer"><a class="btn outline" href="#contact">Запросить КП</a></div>
      </div>
    </div>
  </div>
</section>
  <!-- Cases -->
  <section id="cases" class="section light">
    <div class="container">
      <h2>Кейсы</h2>
      <div class="grid" style="margin-top:16px;grid-template-columns:repeat(1,minmax(0,1fr));gap:16px">
        <div class="card">
          <div class="card-header">
            <div class="card-title" style="display:flex;align-items:center;justify-content:space-between">
              <span>Сочи, п. Лазаревское</span>
              <span class="badge" style="background:#e5e7eb;color:#111827">100 кВт</span>
            </div>
          </div>
          <div class="card-content muted" style="display:grid;gap:6px">
            <div style="display:flex;align-items:center;gap:8px"><i data-lucide="bar-chart-3" style="width:16px;height:16px"></i> 16.8 МВт·ч/мес (средняя генерация)</div>
            <div style="display:flex;align-items:center;gap:8px"><i data-lucide="leaf" style="width:16px;height:16px"></i> 12 т CO₂/мес (компенсация)</div>
            <div style="display:flex;align-items:center;gap:8px"><i data-lucide="map-pin" style="width:16px;height:16px"></i> ул. Калараша 36</div>
          </div>
        </div>
		<div class="grid" style="margin-top:16px;grid-template-columns:repeat(1,minmax(0,1fr));gap:16px">
        <div class="card">
          <div class="card-header">
            <div class="card-title" style="display:flex;align-items:center;justify-content:space-between">
              <span>Сочи, п. Лазаревское</span>
              <span class="badge" style="background:#e5e7eb;color:#111827">50 кВт</span>
            </div>
          </div>
          <div class="card-content muted" style="display:grid;gap:6px">
            <div style="display:flex;align-items:center;gap:8px"><i data-lucide="bar-chart-3" style="width:16px;height:16px"></i> 8.4 МВт·ч/мес (средняя генерация)</div>
            <div style="display:flex;align-items:center;gap:8px"><i data-lucide="leaf" style="width:16px;height:16px"></i> 6 т CO₂/мес (компенсация)</div>
            <div style="display:flex;align-items:center;gap:8px"><i data-lucide="map-pin" style="width:16px;height:16px"></i> ул. Калараша 131</div>
          </div>
        </div>
		<div class="grid" style="margin-top:16px;grid-template-columns:repeat(1,minmax(0,1fr));gap:16px">
        <div class="card">
          <div class="card-header">
            <div class="card-title" style="display:flex;align-items:center;justify-content:space-between">
              <span>Сочи, п. Лазаревское</span>
              <span class="badge" style="background:#e5e7eb;color:#111827">50 кВт</span>
            </div>
          </div>
          <div class="card-content muted" style="display:grid;gap:6px">
            <div style="display:flex;align-items:center;gap:8px"><i data-lucide="bar-chart-3" style="width:16px;height:16px"></i> 8.4 МВт·ч/мес (средняя генерация)</div>
            <div style="display:flex;align-items:center;gap:8px"><i data-lucide="leaf" style="width:16px;height:16px"></i> 6 т CO₂/мес (компенсация)</div>
            <div style="display:flex;align-items:center;gap:8px"><i data-lucide="map-pin" style="width:16px;height:16px"></i> ул. Павлова 2</div>
          </div>
        </div>
        <div class="card">
          <div class="card-header">
            <div class="card-title" style="display:flex;align-items:center;justify-content:space-between">
              <span>Сочи Аше</span>
              <span class="badge" style="background:#e5e7eb;color:#111827">20 кВт</span>
            </div>
          </div>
          <div class="card-content muted" style="display:grid;gap:6px">
            <div style="display:flex;align-items:center;gap:8px"><i data-lucide="bar-chart-3" style="width:16px;height:16px"></i> ~4 МВт·ч/мес (модель)</div>
            <div style="display:flex;align-items:center;gap:8px"><i data-lucide="shield" style="width:16px;height:16px"></i> 2.7 т CO₂/мес (компенсация)</div>
            <div style="display:flex;align-items:center;gap:8px"><i data-lucide="qrcode" style="width:16px;height:16px"></i> Репина 4а</div>
          </div>
        </div>
      </div>
    </div>
  </section>
  <!-- CTA + Form -->
  <section id="cta" class="section" style="background:var(--teal);color:#fff">
    <div class="container">
      <div class="grid two" style="align-items:center">
        <div>
          <h2>Готовы запустить франшизу в вашем городе?</h2>
          <p style="opacity:.8;margin-top:8px">Оставьте контакты — отправим презентацию, юр.структуру и финансовую модель. Ответим на вопросы и назначим созвон.</p>
          <div class="tiny" style="display:flex;align-items:center;gap:6px;margin-top:12px">
            <i data-lucide="shield" style="width:16px;height:16px"></i> Ваши данные в безопасности. Никакого спама.
          </div>
        </div>
        <div class="card" style="background:#fff;color:#111827">
          <div class="card-content">
            <div>
              <label>Имя</label>
              <input class="input" id="name" placeholder="Иван"/>
            </div>
            <div class="grid" style="grid-template-columns:1fr 1fr;gap:12px;margin-top:12px">
              <div>
                <label>E-mail</label>
                <input class="input" id="email" type="email" placeholder="you@example.com"/>
              </div>
              <div>
                <label>Телефон</label>
                <input class="input" id="phone" type="tel" placeholder="+7 ___ ___-__-__"/>
              </div>
            </div>
            <div style="margin-top:12px">
              <label>Город</label>
              <input class="input" id="city" placeholder="Санкт-Петербург"/>
            </div>
            <div style="margin-top:12px">
              <label>Комментарий</label>
              <input class="input" id="comment" placeholder="Кратко о вашем объекте/сети"/>
            </div>
            <button class="btn emerald" id="submitLead" style="width:100%;margin-top:12px">Отправить заявку</button>
            <div class="tiny" id="leadNote" style="margin-top:8px">Нажимая на кнопку, вы соглашаетесь с обработкой персональных данных.</div>
          </div>
        </div>
      </div>
    </div>
  </section>
  <!-- FAQ -->
  <section id="faq" class="section">
    <div class="container">
      <h2>FAQ</h2>
      <div class="accordion" style="margin-top:16px">
        <div class="accordion-item">
          <button class="accordion-trigger">Это про крипту? Будут ли обещания доходности?</button>
          <div class="accordion-content">Нет. <b>GSun</b> — утилитарный токен верификации происхождения энергии и CO₂. Мы не даём обещаний доходности; юридическая модель очищена от признаков ЦФА/ценных бумаг согласно ФЗ-259.</div>
        </div>
        <div class="accordion-item">
          <button class="accordion-trigger">Какие требования к локации?</button>
          <div class="accordion-content">Крыша/площадка без затенений, ориентир на юг (±45°), прочность для монтажа, доступ к щиту/сети, местные разрешения.</div>
        </div>
        <div class="accordion-item">
          <button class="accordion-trigger">Как работает сервис и ТО?</button>
          <div class="accordion-content">Квартальный регламент: проверка панелей, кабелей, разъёмов, соединений, логов, сумматора, инвертора, мойка панелей и обработка воском. Стоимость ТО — по прайсу.</div>
        </div>
        <div class="accordion-item">
          <button class="accordion-trigger">Сколько времени занимает запуск?</button>
          <div class="accordion-content">Поставка оборудования ~35 дней, монтаж 7–10 дней. Каркас можно собирать параллельно с ожиданием оборудования.</div>
        </div>
        <div class="accordion-item">
          <button class="accordion-trigger">Какие пакеты и условия франшизы?</button>
          <div class="accordion-content">Доступны уровни Start / Pro / Enterprise. Размеры паушального взноса и роялти зависят от региона и мощности. Условия согласуются индивидуально и не являются публичной офертой.</div>
        </div>

        <!-- Вопросы о токеномике -->
        <div class="accordion-item">
          <button class="accordion-trigger">Что такое токен GSun (GEN) и как он работает?</button>
          <div class="accordion-content">
            <b>GSun (GEN)</b> — это утилитарный токен, который служит двум целям:
            <ol style="padding-left: 18px; margin: 8px 0;">
              <li><b>Вознаграждение:</b> Вы получаете GEN за каждую произведенную киловатт-час чистой энергии. Он распределяется по цепочке: 70% установщику, 20% региональному представителю, 10% мастер-франчайзи.</li>
              <li><b>Управление:</b> Владельцы GEN могут голосовать за ключевые решения в экосистеме, такие как изменение тарифов или подключение новых регионов.</li>
            </ol>
            GEN можно стейкать для получения дополнительных токенов или продавать на децентрализованных биржах.
          </div>
        </div>
        <div class="accordion-item">
          <button class="accordion-trigger">Как я могу монетизировать энергию кроме продажи электричества?</button>
          <div class="accordion-content">
            Помимо прямой экономии на счетах за электричество, вы можете монетизировать вашу "зеленую" энергию через:
            <ul style="padding-left: 18px; margin: 8px 0;">
              <li><b>eKWH-токены:</b> Продавайте их компаниям, которым нужно подтвердить использование "зеленой" энергии для своей ESG-отчетности.</li>
              <li><b>Углеродные кредиты (NFT):</b> Конвертируйте ваши eKWH в NFT-сертификаты, подтверждающие предотвращенный выброс CO₂. Эти сертификаты можно продать на международных рынках компенсации углеродного следа по более высокой цене.</li>
            </ul>
            Это превращает вашу солнечную станцию в многоуровневый источник дохода.
          </div>
        </div>
        <!-- Конец вопросов -->

      </div>
    </div>
  </section>
  <!-- Footer -->
<footer>
  <div class="container" style="padding:48px 0; background: #f9fafb; border-top: 1px solid #e5e7eb;">
    <div style="display:flex;align-items:center;gap:8px;margin-bottom:24px">
      <span class="hex" id="hex-20"></span>
      <span style="font-weight:600; font-size: 20px;">Greensun</span>
      <span class="badge" style="background:#e5e7eb;color:#111827; font-size: 12px;">GNSun</span>
    </div>

    <div class="grid" style="grid-template-columns:1fr;gap:32px; margin-bottom: 32px;">
      <div>
        <p style="color: #374151; line-height: 1.6; max-width: 600px;">
          Утилитарная верификация происхождения энергии и CO₂ на Polygon. Без обещаний доходности.
        </p>
      </div>

      <div class="grid" style="grid-template-columns:1fr 1fr; gap:32px;">
        <!-- Контакты -->
        <div>
          <div style="font-weight:600; margin-bottom:16px; color: #111827;">Контакты</div>
          <div style="display: flex; flex-direction: column; gap: 12px; font-size: 14px; color: #374151;">
            <div>ИП Удодов Александр Федорович</div>
            <div>ИНН: 615425089014</div>
            <div style="display: flex; align-items: center; gap: 8px;">
              <i data-lucide="mail" style="width: 18px; height: 18px;"></i>
              <a href="mailto:Support@greensun.energy" style="color: #18A957; text-decoration: none;">Support@greensun.energy</a>
            </div>
            <div style="display: flex; align-items: center; gap: 8px;">
              <i data-lucide="phone" style="width: 18px; height: 18px;"></i>
              <a href="tel:+79288117722" style="color: #18A957; text-decoration: none;">+7 (928) 811-77-22</a>
            </div>
          </div>
        </div>

        <!-- Мессенджеры + QR-код -->
        <div>
          <div style="font-weight:600; margin-bottom:16px; color: #111827;">Свяжитесь мгновенно</div>
          <div style="display: flex; flex-direction: column; gap: 16px;">
            <!-- WhatsApp -->
            <a href="https://wa.me/79288117722" target="_blank" style="display: flex; align-items: center; gap: 10px; padding: 10px 14px; border-radius: 10px; background: #f0fdf4; border: 1px solid #bbf7d0; color: #166534; text-decoration: none; font-weight: 600; transition: all 0.2s ease;">
              <i data-lucide="message-circle" style="width: 20px; height: 20px; color: #166534;"></i>
              WhatsApp
            </a>
            <!-- Telegram -->
            <a href="https://t.me/Fantai_main" target="_blank" style="display: flex; align-items: center; gap: 10px; padding: 10px 14px; border-radius: 10px; background: #f0f9ff; border: 1px solid #bae6fd; color: #086594; text-decoration: none; font-weight: 600; transition: all 0.2s ease;">
              <i data-lucide="send" style="width: 20px; height: 20px; color: #086594;"></i>
              Telegram
            </a>
            <!-- QR-код -->
            <div style="margin-top: 8px;">
              <div style="font-size: 13px; color: #6b7280; margin-bottom: 8px;">Сканируйте QR-код:</div>
              <div style="background: white; padding: 12px; border-radius: 12px; display: inline-block; border: 1px solid #e5e7eb; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                <!-- Простой placeholder QR-кода. Замените на реальный URL -->
                <img src="https://api.qrserver.com/v1/create-qr-code/?size=120x120&data=https://greensun.energy" alt="QR-код Greensun" style="width: 120px; height: 120px; display: block;">
                <div class="tiny" style="text-align: center; margin-top: 6px;">Перейти на сайт</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div>
        <div style="font-weight:600; margin-bottom:16px; color: #111827;">Документы</div>
        <ul style="display:grid;gap:6px;padding-left:0;list-style:none; font-size: 14px;">
          <li><a class="underline" href="#" style="color: #18A957; text-decoration: none;">Brandbook (RU/EN)</a></li>
          <li><a class="underline" href="#" style="color: #18A957; text-decoration: none;">Презентация</a></li>
          <li><a class="underline" href="#" style="color: #18A957; text-decoration: none;">Юридический меморандум</a></li>
        </ul>
      </div>
    </div>

    <div class="tiny" style="margin-top:16px; padding-top: 16px; border-top: 1px solid #e5e7eb; color: #6b7280; text-align: center;">
      © <span id="year"></span> Greensun. Все права защищены.
    </div>
  </div>
</footer>
  <script>
    // Simple helpers
    const $ = (s)=>document.querySelector(s);
    // Hex "G" logo
    function renderHex(el, size=28, fill=getComputedStyle(document.documentElement).getPropertyValue('--gold').trim(), bg='transparent'){
      const s=size, cx=s/2, cy=s/2, R=s*0.40;
      const pts = Array.from({length:6}).map((_,i)=>{
        const ang=((30+i*60)*Math.PI)/180;
        return (cx+R*Math.cos(ang))+','+(cy+R*Math.sin(ang));
      }).join(' ');
      const wedge = [(cx - 0.06*s)+','+(cy - 0.42*s),(cx + 0.44*s)+','+(cy - 0.06*s),(cx - 0.06*s)+','+(cy + 0.12*s)].join(' ');
      el.innerHTML = '<svg width="'+s+'" height="'+s+'" viewBox="0 0 '+s+' '+s+'" aria-hidden>'+
        '<rect width="100%" height="100%" fill="'+bg+'"/>'+
        '<polygon points="'+pts+'" fill="'+fill+'"/>'+
        '<polygon points="'+wedge+'" fill="'+bg+'"/>'+
        '<circle cx="'+cx+'" cy="'+cy+'" r="'+(s*0.165)+'" fill="'+bg+'"/>'+
        '<rect x="'+(cx - s*0.01)+'" y="'+(cy - s*0.045/2)+'" width="'+(s*0.22)+'" height="'+(s*0.045)+'" fill="'+bg+'"/>'+
      '</svg>';
    }
    renderHex($('#hex-28'),28); renderHex($('#hex-20'),20);
    // Icons
    document.addEventListener('DOMContentLoaded',()=>{ if (window.lucide) lucide.createIcons(); });
    // Calculator
    const monthKWhPerKW = 168;
    function recalc(){
      const capacityKW = Number($('#capacityKW').value||0);
      const tariff = Number($('#tariff').value||0);
      const ins = Number($('#insolation').value||1);
      const projectCost = Number($('#projectCost').value||0);
      const monthlyKWh = Math.round(capacityKW * monthKWhPerKW * ins);
      const monthlyRevenue = Math.round(monthlyKWh * tariff);
      $('#monthlyKWh').textContent = monthlyKWh.toLocaleString('ru-RU');
      $('#monthlyRevenue').textContent = monthlyRevenue.toLocaleString('ru-RU');
      const note = $('#calcNote');
      if (projectCost>0 && monthlyRevenue>0){
        const pbMonths = projectCost / monthlyRevenue;
        note.innerHTML = 'Расчёт ориентировочный. Фактические цифры зависят от инсоляции, оборудования и профиля потребления.<br>Окупаемость ≈ <b>'+pbMonths.toFixed(1)+'</b> мес ('+(pbMonths/12).toFixed(1)+' лет)';
      } else {
        note.textContent = 'Расчёт ориентировочный. Фактические цифры зависят от инсоляции, оборудования и профиля потребления.';
      }
    }
    ['capacityKW','tariff','insolation','projectCost'].forEach(id=>$('#'+id).addEventListener('input', recalc));
    recalc();
    // Accordion
    document.querySelectorAll('.accordion-item').forEach(item=>{
      const btn = item.querySelector('.accordion-trigger');
      btn.addEventListener('click', ()=> item.classList.toggle('open'));
    });
    // Lead form (mock)
    $('#submitLead').addEventListener('click', ()=>{
      const payload = {
        name: $('#name').value.trim(),
        email: $('#email').value.trim(),
        phone: $('#phone').value.trim(),
        city: $('#city').value.trim(),
        comment: $('#comment').value.trim(),
        source: 'landing_franchise_static',
        ts: new Date().toISOString()
      };
      console.log('[mock submit]', payload);
      $('#leadNote').textContent = 'Спасибо! Мы свяжемся с вами в ближайшее время.';
    });
    // Footer year
    $('#year').textContent = new Date().getFullYear();
    // Tiny responsive niceties
    function onResize(){
      const nav = $('#nav-desktop');
      if (window.innerWidth>=900) nav.style.display = 'flex'; else nav.style.display='none';
    }
    window.addEventListener('resize', onResize); onResize();
  </script>
<script>
/* ====== CONFIG: monitoring endpoint (override with window.GSUN_OBJECTS_ENDPOINT before this script) ====== */
const GSUN_OBJECTS_ENDPOINT = window.GSUN_OBJECTS_ENDPOINT || '/api/objects.json';
/* ====== Fallback objects ====== */
let GS_OBJECTS = [
  { id:'pavlova2',     name:'Сочи, Лазаревское — Павлова, 2',    lat:43.905583, lon:39.326725, mwh:16.8, kw:100 },
  { id:'kalarasha131', name:'Сочи, Лазаревское — Калараша, 131', lat:43.912564, lon:39.339149, mwh:16.8, kw:100 },
  { id:'kalarasha36',  name:'Сочи, Лазаревское — Калараша, 36',  lat:43.906505, lon:39.332079, mwh:16.8, kw:100 },
  { id:'pilot_center', name:'Лазаревское — центр (пилот)',       lat:43.908900, lon:39.331400, mwh:8.4, kw:50 },
  { id:'pilot_shosse2',name:'Сочинское ш., 2 (пилот)',           lat:43.901848, lon:39.340613, mwh:8.4, kw:50 }
];
/* ====== Load from monitoring (optional) ====== */
async function tryFetchMonitoring(){
  try{
    const r = await fetch(GSUN_OBJECTS_ENDPOINT, {cache:'no-store'});
    if(!r.ok) return;
    const data = await r.json();
    GS_OBJECTS = data.map((o,i)=>({
      id: o.id || `obj_${i}`,
      name: o.name || o.address || 'Объект',
      lat:  Number(o.lat),
      lon:  Number(o.lon),
      kw:   Number(o.kw || o.capacity_kw || 0),
      mwh:  o.mwh != null ? Number(o.mwh)
           : (o.monthly_mwh != null ? Number(o.monthly_mwh)
           : (o.kwh_month != null ? Number(o.kwh_month)/1000 : 0))
    })).filter(o=>isFinite(o.lat)&&isFinite(o.lon));
    const sel = document.getElementById('radiusCenter');
    if (sel){
      sel.innerHTML = GS_OBJECTS.map(o=>`<option value="${o.id}">${o.name}</option>`).join('');
    }
  }catch(e){ /* ignore */ }
}
/* ====== Map center detection ====== */
function detectMapCenter(){
  if (window.L && window.gsunLeafletMap && typeof window.gsunLeafletMap.getCenter==='function'){
    const c = window.gsunLeafletMap.getCenter();
    return {lat:c.lat, lon:c.lng};
  }
  if (window.mapboxgl && window.gsunMapboxMap && typeof window.gsunMapboxMap.getCenter==='function'){
    const c = window.gsunMapboxMap.getCenter();
    return {lat:c.lat, lon:c.lng};
  }
  if (window.ymaps && window.gsunYMap && typeof window.gsunYMap.getCenter==='function'){
    const [lon,lat] = window.gsunYMap.getCenter();
    return {lat, lon};
  }
  if (window.google && window.gsunGMap && typeof window.gsunGMap.getCenter==='function'){
    const c = window.gsunGMap.getCenter();
    return {lat:c.lat(), lon:c.lng()};
  }
  return null;
}
/* ====== Click on map chips (data-lat / data-lon) ====== */
(function enableChipClicks(){
  const mapSection = document.querySelector('#map .map');
  if (!mapSection) return;
  mapSection.addEventListener('click', (e)=>{
    const el = e.target.closest('[data-lat][data-lon]');
    if (!el) return;
    const lat = Number(el.getAttribute('data-lat'));
    const lon = Number(el.getAttribute('data-lon'));
    if (isFinite(lat) && isFinite(lon)){
      setManualCenter({lat, lon});
    }
  });
})();
/* ====== Manual center ====== */
let manualCenter = null;
function setManualCenter(c){
  manualCenter = c;
  const latEl = document.getElementById('centerLat');
  const lonEl = document.getElementById('centerLon');
  if (latEl) latEl.textContent = (c?.lat ?? '—').toLocaleString('ru-RU', {maximumFractionDigits:6});
  if (lonEl) lonEl.textContent = (c?.lon ?? '—').toLocaleString('ru-RU', {maximumFractionDigits:6});
  recalcRadius();
}
/* ====== Haversine ====== */
function haversine(lat1, lon1, lat2, lon2){
  const R = 6371, toRad = d => d*Math.PI/180;
  const dLat = toRad(lat2-lat1), dLon = toRad(lon2-lon1);
  const a = Math.sin(dLat/2)**2 + Math.cos(toRad(lat1))*Math.cos(toRad(lat2))*Math.sin(dLon/2)**2;
  return R * (2*Math.atan2(Math.sqrt(a), Math.sqrt(1-a)));
}
/* ====== Radius calc ====== */
function getCenterObj(){
  const id = document.getElementById('radiusCenter')?.value;
  return GS_OBJECTS.find(o=>o.id===id);
}
function currentCenter(){
  const useMap = document.getElementById('useMapCenter')?.checked;
  if (useMap){
    const live = detectMapCenter();
    if (live){ setManualCenter(live); return live; }
    if (manualCenter) return manualCenter;
  }
  const obj = getCenterObj();
  if (obj) return {lat:obj.lat, lon:obj.lon, selfId: obj.id};
  return null;
}
function recalcRadius(){
  const center = currentCenter();
  const rKm = Number(document.getElementById('radiusKm')?.value || 5);
  const excludeSelf = !!document.getElementById('excludeSelf')?.checked;
  const out = {
    countEl: document.getElementById('rCount'),
    sumEl:   document.getElementById('rMWh'),
    proEl:   document.getElementById('rProMWh'),
    rubEl:   document.getElementById('rProRub'),
  };
  if (!center || !isFinite(center.lat) || !isFinite(center.lon)){
    out.countEl.textContent = out.sumEl.textContent = out.proEl.textContent = out.rubEl.textContent = '—';
    return;
  }
  let within = GS_OBJECTS.filter(o => haversine(center.lat, center.lon, o.lat, o.lon) <= rKm);
  if (excludeSelf && center.selfId){
    within = within.filter(o => o.id !== center.selfId);
  }
  const count  = within.length;
  const sumMWh = within.reduce((s,o)=>s+Number(o.mwh||0), 0);
  const proMWh = sumMWh * 0.10;
  const tariff = Number(document.getElementById('tariff')?.value || 0); // ₽/кВт·ч
  const proRub = proMWh * 1000 * tariff; // МВт·ч -> кВт·ч
  out.countEl.textContent = count.toLocaleString('ru-RU');
  out.sumEl.textContent   = sumMWh.toLocaleString('ru-RU', {maximumFractionDigits:1});
  out.proEl.textContent   = proMWh.toLocaleString('ru-RU', {maximumFractionDigits:2});
  out.rubEl.textContent   = Math.round(proRub).toLocaleString('ru-RU');
}
/* ====== Bindings ====== */
['radiusCenter','radiusKm','tariff','useMapCenter','excludeSelf'].forEach(id=>{
  const el = document.getElementById(id);
  if (el) el.addEventListener('input', recalcRadius);
});
document.getElementById('syncMapCenter')?.addEventListener('click', ()=>{
  const live = detectMapCenter();
  if (live) setManualCenter(live);
  else recalcRadius();
});
document.addEventListener('DOMContentLoaded', async ()=>{
  await tryFetchMonitoring();
  const live = detectMapCenter();
  if (live) setManualCenter(live); else recalcRadius();
});
</script>
<!-- Lead Modal -->
<div id="leadModal" class="modal" aria-hidden="true" aria-labelledby="leadTitle">
  <div class="modal-card" role="dialog" aria-modal="true">
    <div class="modal-head">
      <div class="modal-title" id="leadTitle">Заявка на франшизу</div>
      <button class="modal-close" type="button" aria-label="Закрыть" id="leadClose">✕</button>
    </div>
    <form id="leadForm">
      <div class="modal-body">
        <div class="badge">Пакет: <b id="leadPackLabel">—</b></div>
        <input type="hidden" name="package" id="leadPack" value=""/>
        <div class="grid-2" style="margin-top:12px">
          <div>
            <label>Имя</label>
            <input class="input" name="name" id="leadName" required placeholder="Иван Петров">
          </div>
          <div>
            <label>Телефон</label>
            <input class="input" name="phone" id="leadPhone" required placeholder="+7 999 123‑45‑67">
          </div>
          <div>
            <label>Email</label>
            <input class="input" type="email" name="email" id="leadEmail" required placeholder="name@example.com">
          </div>
          <div>
            <label>Компания (необязательно)</label>
            <input class="input" name="company" id="leadCompany" placeholder="ООО «...»">
          </div>
        </div>
        <div style="margin-top:12px">
          <label>Комментарий</label>
          <textarea class="textarea" name="message" id="leadMsg" placeholder="Коротко опишите задачу"></textarea>
        </div>
      </div>
      <div class="modal-foot">
        <button type="button" class="btn" id="leadCancel">Отмена</button>
        <button type="submit" class="btn primary" id="leadSubmit">Отправить</button>
      </div>
    </form>
  </div>
</div>
<script>
// Franchise tabs highlight (FIXED & STABLE)
(function(){
  const tabs = document.querySelectorAll('#franchTabs .seg-btn');
  const cards = {
    start: document.getElementById('pack-start'),
    pro: document.getElementById('pack-pro'),
    enterprise: document.getElementById('pack-enterprise')
  };

  function activate(target){
    // 1. Обновляем состояние кнопок
    tabs.forEach(button => {
      const isActive = button.dataset.target === target;
      button.classList.toggle('is-active', isActive);
      button.setAttribute('aria-selected', String(isActive));
    });

    // 2. Обновляем состояние карточек
    Object.entries(cards).forEach(([key, card]) => {
      if (!card) return;
      const isActive = key === target;
      card.classList.toggle('is-highlighted', isActive);
    });

    // 3. Плавно скроллим к активной карточке
    if (cards[target]) {
      cards[target].scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    }
  }

  // Назначаем обработчики кликов
  tabs.forEach(button => {
    button.addEventListener('click', () => {
      activate(button.dataset.target);
    });
  });

  // По умолчанию активируем вкладку "Pro"
  activate('pro');
})();
</script>
<script>
// Modal lead form
(function(){
  const modal = document.getElementById('leadModal');
  const packLabel = document.getElementById('leadPackLabel');
  const packInput  = document.getElementById('leadPack');
  const closeBtn = document.getElementById('leadClose');
  const cancelBtn = document.getElementById('leadCancel');
  const form = document.getElementById('leadForm');
  const submitBtn = document.getElementById('leadSubmit');
  const OWNER_EMAIL = 'Support@greensun.energy';
  const FORMS_ENDPOINT = 'https://formsubmit.co/' + OWNER_EMAIL;
  function openModal(pack){
    packLabel.textContent = pack;
    packInput.value = pack;
    modal.classList.add('is-open');
    modal.setAttribute('aria-hidden','false');
    setTimeout(()=>document.getElementById('leadName')?.focus(), 50);
  }

  function closeModal(){
    modal.classList.remove('is-open');
    modal.setAttribute('aria-hidden','true');
  }

  [closeBtn, cancelBtn].forEach(el=>el?.addEventListener('click', closeModal));
  modal.addEventListener('click', (e)=>{ if (e.target===modal) closeModal(); });

  // Hook all CTA buttons in #package
  document.querySelectorAll('#package .card').forEach(card=>{
    const pack = card.dataset.pack || card.querySelector('.card-title')?.textContent || 'Franchise';
    card.querySelectorAll('.card-footer a.btn, .card-footer a').forEach(a=>{
      a.addEventListener('click', (e)=>{
        if (a.getAttribute('href')?.startsWith('#') || a.getAttribute('href')?.endsWith('.pdf') || a.getAttribute('href')==='#contact'){
          e.preventDefault();
        }
        openModal(pack);
      });
    });
  });

  form.addEventListener('submit', async (e)=>{
    e.preventDefault();
    submitBtn.disabled = true;
    submitBtn.textContent = 'Отправка…';
    const payload = {
      package: packInput.value,
      name: form.name.value,
      phone: form.phone.value,
      email: form.email.value,
      company: form.company.value,
      message: form.message.value,
      page: location.href,
      when: new Date().toISOString()
    };
    try{
      if (FORMS_ENDPOINT){
        const r = await fetch(FORMS_ENDPOINT, {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify(payload)
        });
        if (!r.ok) throw new Error('Form endpoint error');
        alert('Заявка отправлена! Мы свяжемся с вами.');
        closeModal();
      } else {
        const subject = encodeURIComponent(`[Greensun] Заявка: ${payload.package}`);
        const body = encodeURIComponent(
          `Пакет: ${payload.package}
Имя: ${payload.name}
Телефон: ${payload.phone}
Email: ${payload.email}
Компания: ${payload.company}
Сообщение: ${payload.message}
Страница: ${payload.page}
Время: ${payload.when}`
        );
        window.location.href = `mailto:${OWNER_EMAIL}?subject=${subject}&body=${body}`;
        closeModal();
      }
    }catch(err){
      console.error(err);
      alert('Не удалось отправить. Попробуйте ещё раз или напишите нам по email.');
    }finally{
      submitBtn.disabled = false;
      submitBtn.textContent = 'Отправить';
    }
  });

  window.openLeadModal = openModal;
})();
</script>
</body>
</html>
